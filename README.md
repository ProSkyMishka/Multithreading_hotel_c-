# АВС ИДЗ 4
Прозорский Михаил Алексеевич
БПИ224
Вариант 16

## Условие
Задача о социалистической гостинице. В гостинице 30 одноместных номеров. Клиенты гостиницы снимают номер на одни или несколько суток (задается при создании клиента). Если в гостинице нет свободных номеров, клиенты не уходят, а устраиваются рядом с гостиницей на скамейках и ждут в порядке очереди, пока любой из номеров не освободится (других гостиниц в городе нет). Создать многопоточное приложение, моделирующее работу гостиницы. Каждого клиента и гостиницу (точнее ее администратора) моделировать отдельным потоком.

Мои уточнения: Пользователем задается количество секунд, которое отель будет работать. Посетители генерируются каждую секунду. Одни сутки равны 24 секундам, то есть если клиент бронирует комнату на двое суток, то он остается там на 2*24=48 секунд, а затем уходит. У каждого клиента рандомно генерируется количество суток, которые он проводит в отеле. 

## Сценарий
Пользователь приходит, если есть свободные номера и нет очереди, то выбирает первый по списку и останавливается там на определенное количество суток. Если свободных номеров нет, то ждет, тем самым формируя очередь
Когда номер освобождается, то посетитель, стоявший в очереди первым, занимает его
Если гостиница закрывается, но есть люди, стоящие в очереди, то закрытие переносится, пока все не расселятся, а потом не съедут

## Решение
Входные данные: время работы отеля в секундах
В начале инициализируются 30 mutex, которые являются комнатами в отеле (rooms). А также mutex, который связан с работой отеля (hotel_work). Запускается цикл, где создается поток отеля. Отель работает, is_working принимает значение true, и блокируется mutex hotel_work на время работы отеля. Затем в цикле генерируются посетители каждую секунду, пока отель работает. Лишь первый инициированный администратор имеет доступ к hotel_work, следовательно другие не влияют на работу.

Написана структура посетителя. Она имеет id посетителя и количество суток(days)

При генерации клиента, инициируется отдельный поток. У посетителя рандомно генерируется количество суток (от 1 до 3). Далее гость встает в очередь. 

После этого, проверяется наличие свободных комнат и наличие самой очередь. Если есть свободные комнаты, то клиент её занимает. Если нет свободных комнат, клиент остается в очереди и ждёт. Каждый раз мы проходимся по определенному диапазону комнат в массиве rooms.
Когда отель закрывается (is_working = false), новые гости не генерируются, но уже заселившиеся гости могут покинуть свои номера после закрытия отеля, а люди, стоящие в очереди, сначала заселяются по очереди, пока все не расселятся, а потом уезжают. 

Модель: Управляющий и рабочие. Модель организации вычислений, при которой существует поток, координирующий работу всех остальных потоков. Как правило, управляющий поток распределяет данные, собирает и анализирует результаты.

## Вывод
* Когда нет свободного номера:
Visitor with id 60 couldn't take a room and wait in the queue
![](telegram-cloud-photo-size-2-5350327875905115536-y.jpg)

* Когда есть или появляется:
Visitor with id 60 has taken room number 20 on 1 days
![](telegram-cloud-photo-size-2-5350327875905115536-y.jpg)

## Выполнено на 6-7 баллов
* Соблюдены общие требования к отчету.
* В отчете должен быть приведен сценарий, описывающий одновременное поведение представленных в условии задания сущностей в терминах предметной области. То есть, описан сценарий, задающий ролевое поведение субъектов и объектов задачи (интерпретация условия с большей степенью детализации происходящего), а не то, как это будет реализовано в программе.
* Описана модель параллельных вычислений, используемая при разработке многопоточной программы.
* Описаны входные данные программы, включающие вариативные диапазоны, возможные при многократных запусках.
* Реализовано консольное приложение, решающее поставленную задачу с использованием одного варианта изученных синхропримитивов.
* Реализован ввод исходных данных из командной строки при запуске программы вместо ввода параметров с консоли во время выполнения программы.
* Для используемых генераторов случайных чисел описаны их диапазоны и то, как интерпретируются данные этих генераторов.
* Вывод программы должен быть информативным, отражая все ключевые протекающие в ней события в терминах предметной области. Наблюдатель на основе вывода программы должен понимать, что в ней происходит в каждый момент времени ее работы.
* В программе присутствуют комментарии, поясняющие выполняемые действия и описание используемых объектов и переменных.
* В отчете подробно описан обобщенный алгоритм, используемый при реализации программы исходного словесного сценария. В котором показано, как на программу отображается каждый из субъектов предметной области.
* В программу добавлена генерация случайных данных в допустимых диапазонах.
* Результаты работы программы представлены в отчете.
